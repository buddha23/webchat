<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lld360.cnc.repository.ImgFilesDao">

    <!-- 定义全局查询的SQL变量语句 -->
    <sql id="searchCondition">
        <where>
            <if test="type != null">type = #{type}</if>
            <if test="name != null and name != ''">
                name LIKE "%"#{name}"%"
            </if>
            <if test="path != null and path != ''">
                path LIKE "%"#{path}"%"
            </if>
            <if test="description != null and description != ''">
                description LIKE "%"#{description}"%"
            </if>
            <if test="status != null">status = #{status}</if>
            <if test="createTime != null">create_time = #{createTime}</if>
            <if test="expireTime != null">expire_time = #{expireTime}</if>
        </where>
    </sql>
    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
        <![CDATA[
        	id ,
        	`type` ,
        	`name`,
        	path ,
        	link,
        	description ,
        	status ,
        	create_time ,
        	expire_time
	    ]]>
    </sql>

    <select id="search" parameterType="map" resultMap="btfilesMap">
        SELECT
        <include refid="columns"/>
        FROM  img_files
        <include refid="searchCondition"/>
        ORDER BY (`name` + 0),id DESC
    </select>

    <select id="count" parameterType="map" resultType="long">
        SELECT count(1)
        FROM img_files
        <include refid="searchCondition"/>
    </select>

    <select id="find" parameterType="long" resultMap="btfilesMap">
        SELECT
        <include refid="columns"/>
        FROM  img_files
        WHERE id = #{id}
    </select>

    <select id="findByName" parameterType="string" resultMap="btfilesMap">
        SELECT
        <include refid="columns"/>
        FROM  img_files
        WHERE `name` = #{name}
        LIMIT 1
    </select>

    <select id="findbytype" parameterType="long" resultMap="btfilesMap">
        SELECT
        <include refid="columns"/>
        FROM  img_files
        WHERE type = #{type}
        order by (`name`+0)
    </select>

    <insert id="create" parameterType="com.lld360.cnc.model.ImgFile" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO
        img_files (
        `type`,
        `name` ,
        path ,
        link,
        description ,
        status ,
        create_time ,
        expire_time
        ) VALUES (
        #{type} ,
        #{name} ,
        #{path} ,
        #{link},
        #{description} ,
        #{status} ,
        #{createTime} ,
        #{expireTime}
        )
    </insert>

    <update id="update" parameterType="com.lld360.cnc.model.ImgFile">
        UPDATE img_files
        <set>
            <if test="type != null and type != 0">`type` = #{type}, </if>
            <if test="name != null">`name` = #{name}, </if>
            <if test="path != null">path = #{path}, </if>
            <if test="link != null">link = #{link}, </if>
            <if test="description != null">description = #{description}, </if>
            <if test="status != null">status = #{status}, </if>
            <if test="createTime != null">create_time = #{createTime}, </if>
            <if test="expireTime != null">expire_time = #{expireTime}, </if>
        </set>
        WHERE id = #{id};
    </update>



    <delete id="delete" parameterType="long">
        DELETE FROM img_files WHERE id = #{id}
    </delete>

    <delete id="deleteurl" parameterType="string">
        DELETE FROM img_files WHERE path = #{path}
    </delete>
    <!-- 结果集mapper -->
    <resultMap id="btfilesMap" type="com.lld360.cnc.model.ImgFile">
        <result property="id" column="id"/>
        <result property="type" column="type"/>
        <result property="name" column="name"/>
        <result property="path" column="path"/>
        <result property="link" column="link"/>
        <result property="description" column="description"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="expireTime" column="expire_time"/>
    </resultMap>

    <select id="maxName"  resultType="string">
        SELECT
        MAX(`name`)
        FROM  img_files
    </select>

    <update id="updateList" parameterType="list">
        <foreach collection="imgFiles" item="imgFile" separator="" open="" close="">
            update img_files set
            name = #{imgFile.name}
            where id= #{imgFile.id};
        </foreach>
    </update>

</mapper>
