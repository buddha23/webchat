<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lld360.cnc.repository.CopyWritingDao">

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
        <![CDATA[
        	id ,
        	title ,
        	keyword ,
        	content ,
        	publish_time publishTime,
        	creater
	    ]]>
    </sql>

    <!-- 定义全局查询的SQL变量语句 -->
    <sql id="searchCondition">
        <where>
            <if test="title != null">AND title like "%"#{title}"%"</if>
            <if test="keyword != null">AND keyword = #{keyword}</if>
            <if test="content != null">AND content like "%"#{content}"%"</if>
            <if test="publishTime != null">AND publish_time = #{publishTime}</if>
            <if test="searchkey != null">AND (title REGEXP #{searchkey} OR keyword REGEXP #{searchkey} OR content REGEXP #{searchkey})</if>
        </where>
    </sql>

    <insert id="create" parameterType="com.lld360.cnc.model.CopyWriting">
        INSERT INTO
        copy_writing (
        	title ,
        	keyword ,
        	content ,
        	publish_time ,
        	creater
        ) VALUES (
        	#{title} ,
        	#{keyword} ,
        	#{content} ,
        	#{publishTime} ,
        	#{creater}
        )
    </insert>

    <update id="update" parameterType="com.lld360.cnc.model.CopyWriting">
        UPDATE copy_writing
        <set>
            <if test="title != null">title = #{title}, </if>
            <if test="keyword != null">keyword = #{keyword}, </if>
            <if test="content != null">content = #{content}, </if>
            <if test="publishTime != null">publish_time = #{publishTime}, </if>
            <if test="creater != null">creater = #{creater}</if>
        </set>
        WHERE id = #{id};
    </update>

    <select id="search" parameterType="map" resultType="com.lld360.cnc.model.CopyWriting">
        SELECT
        <include refid="columns"/>
        FROM  copy_writing
        <include refid="searchCondition"/>
        ORDER BY publish_time DESC
        <if test="limit != null">LIMIT #{limit}</if>
        <if test="offset != null">OFFSET #{offset}</if>
    </select>

    <select id="count" parameterType="map" resultType="long">
        SELECT COUNT(1)
        FROM  copy_writing
        <include refid="searchCondition"/>
    </select>

    <select id="findById" parameterType="long" resultType="com.lld360.cnc.model.CopyWriting">
        SELECT
        <include refid="columns"/>
        FROM  copy_writing
        WHERE id = #{id}
    </select>

    <select id="findByKeyword" parameterType="string" resultType="com.lld360.cnc.model.CopyWriting">
        SELECT
        <include refid="columns"/>
        FROM  copy_writing
        WHERE keyword = #{keyword}
    </select>

    <delete id="delete" parameterType="long">
        DELETE FROM copy_writing WHERE id = #{id}
    </delete>

    <delete id="deleteSome">
        DELETE FROM copy_writing
        WHERE id IN
        <foreach collection="array" item="id"  open="(" separator="," close=")">#{id}</foreach>
    </delete>
</mapper>